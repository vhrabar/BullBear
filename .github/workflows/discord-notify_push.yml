name: Notify Discord on Push

on:
  push:
    branches:
      - '**'

jobs:
  notify_push:
    runs-on: ubuntu-latest
    steps:
      - name: Prepare message
        id: prepare
        run: |
          REPO="${GITHUB_REPOSITORY}"
          BRANCH="${GITHUB_REF#refs/heads/}"
          COMMIT_MESSAGE="${GITHUB_EVENT_HEAD_COMMIT_MESSAGE:-None}"
          COMMIT_URL="${GITHUB_EVENT_HEAD_COMMIT_URL:-#}"
          ACTOR="${GITHUB_ACTOR}"
          MESSAGE="**ðŸŸ¢ Novi commit u repozitoriju $REPO**\nGrana: \`$BRANCH\`\nAutor: $ACTOR\nPoruka: $COMMIT_MESSAGE\n[Pregledaj commit]($COMMIT_URL)"
          echo "message=$MESSAGE" >> $GITHUB_OUTPUT

      - name: Send notification to Discord
        run: |
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{\"content\": \"${{ steps.prepare.outputs.message }}\"}" \
               ${{ secrets.DISCORD_WEBHOOK }}
